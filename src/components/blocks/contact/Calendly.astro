---
// Calendly Widget
// ------------
// Description: Embedded Calendly booking widget

// Components
// - Layout
import Section from '../../ui/Section.astro'
import Row from '../../ui/Row.astro'
import Col from '../../ui/Col.astro'

// Props
type Props = {
	classes?: string
	url?: string
}
const { classes, url = 'https://calendly.com/ben-horton-finance-janet/30min' } = Astro.props
---

<Section id="book-lesson" classes={classes}>
	<Row>
		<Col span="12" align="center" classes="mb-8">
			<h2 class="text-balance">Book Your <strong>Free Intro Call</strong></h2>
			<p class="pb-0 text-lg max-w-3xl mx-auto">
				Free intro call, no commitment. Select a time that works for you.
			</p>
		</Col>
	</Row>
	<Row>
		<Col span="12">
			<!-- Calendly inline widget begin -->
			<div
				class="calendly-inline-widget"
				data-url={url}
				style="min-width:320px;height:700px;"
			></div>
			<!-- Calendly inline widget end -->
		</Col>
	</Row>
</Section>

<script define:vars={{url}}>
	function initCalendly() {
		// Wait for Calendly library to be available
		if (!window.Calendly) {
			setTimeout(initCalendly, 100);
			return;
		}
		
		// Initialize the widget - it will find the widget div automatically by class
		window.Calendly.initInlineWidget({
			url: url,
			parentElement: document.querySelector('.calendly-inline-widget')
		});
	}
	
	// Initialize when DOM is ready
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initCalendly);
	} else {
		initCalendly();
	}
	
	// Reinitialize after view transitions
	document.addEventListener('astro:after-swap', initCalendly);
</script>

<style>
	.calendly-inline-widget {
		position: relative;
		width: 100%;
	}
</style>
