---
// Calendly Widget
// ------------
// Description: Embedded Calendly booking widget

// Components
// - Layout
import Section from '../../ui/Section.astro'
import Row from '../../ui/Row.astro'
import Col from '../../ui/Col.astro'

// Props
type Props = {
	classes?: string
	url?: string
}
const { classes, url = 'https://calendly.com/ben-horton-finance-janet/30min' } = Astro.props
---

<Section id="book-lesson" classes={classes}>
	<Row>
		<Col span="12" align="center" classes="mb-8">
			<h2 class="text-balance">Book Your <strong>Free Intro Call</strong></h2>
			<p class="pb-0 text-lg max-w-3xl mx-auto">
				Free intro call, no commitment. Select a time that works for you.
			</p>
		</Col>
	</Row>
	<Row>
		<Col span="12">
			<div
				id="calendly-widget-container"
				class="calendly-inline-widget"
				data-url={url}
				style="min-width:320px;height:700px;"
			></div>
		</Col>
	</Row>
</Section>

<script is:inline>
	window.addEventListener('load', function() {
		// Load Calendly script if not already loaded
		if (!window.Calendly) {
			var script = document.createElement('script');
			script.src = 'https://assets.calendly.com/assets/external/widget.js';
			script.async = false; // Load synchronously to ensure it's available
			script.onload = function() {
				console.log('Calendly widget loaded successfully');
				initCalendly();
			};
			script.onerror = function() {
				console.error('Failed to load Calendly widget');
				var container = document.getElementById('calendly-widget-container');
				if (container) {
					container.innerHTML = '<p style="text-align:center;padding:2rem;">Failed to load booking widget. Please <a href="https://calendly.com/ben-horton-finance-janet/30min" target="_blank" style="color:#80D490;text-decoration:underline;">click here to book directly</a>.</p>';
				}
			};
			document.head.appendChild(script);
		} else {
			// Calendly already loaded, initialize immediately
			initCalendly();
		}
		
		function initCalendly() {
			if (window.Calendly) {
				var container = document.querySelector('.calendly-inline-widget');
				if (container) {
					var url = container.getAttribute('data-url');
					window.Calendly.initInlineWidget({
						url: url,
						parentElement: container
					});
				}
			}
		}
	});
</script>

<style>
	.calendly-inline-widget {
		position: relative;
		width: 100%;
	}
</style>
